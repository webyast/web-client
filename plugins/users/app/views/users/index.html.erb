<!--
# Copyright (c) 2009-2010 Novell, Inc.
# 
# All Rights Reserved.
# 
# This program is free software; you can redistribute it and/or modify it
# under the terms of version 2 of the GNU General Public License
# as published by the Free Software Foundation.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, contact Novell, Inc.
# 
# To contact Novell about this file by physical or electronic mail,
# you may find current contact information at www.novell.com
-->

<% content_for :head do %>
 <% if JSMIN == true %>  
    <%= javascript_include_tag "users-min.js"-%>
  <% else %>
    <%= javascript_include_tag "jquery.quicksearch.js"-%>
    <%= javascript_include_tag "select_dialog.js" %>
    <%= javascript_include_tag "users.js" %>
  <% end %>
 
<!-- if no groups, disable validation-->
<% if @permissions[:groupsget] != true %>
<script language="javascript">
  function groups_validation(which){ return true; }
  function def_group_validation(which){ return true; }
</script>
<% end %>       

 <style type="text/css">
    .pad1_2em {
/* 	padding: 1em 2em; */
    }
    tr {
	border: solid 1px #ddd;
    }
    label, .qs_input {
	width: auto !important;
    }
    .label {
        min-width: 10em;
        float: left;
        margin-left: 1em
    }
    #password-strength {
	left: 0em;
    }
  
/*     .nav-buttons {padding:0; margin:0px;} */
 </style>

 <% javascript_tag do %>
 jQuery.expr[':'].Contains = function(a, i, m) {
  return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase()) >= 0;
 };

  function select_groups_dialog() {
    var open_dialog = select_many_dialog({
      kind : 'groups',
      title : '<%= _('Select Groups') %>',
      selected_title : '<%= _('Selected Groups') %>',
      unselected_title : '<%= _('Available Groups') %>',
      tooltip : '<%= _('Click group names to select/unselect groups') %>',
      loadItems : function (dialogId) { 
        return $('#form_'+dialogId+' .grp-string')[0].value.split(",")
      },
      storeItems : function (dialogId, items) { 
        $('#form_'+dialogId+' .grp-string')[0].value = items.join(",");
      },
      allItems : function (dialogId) { 
        return $('#all_grps_string')[0].value.split(",") 
      }
    });
    return open_dialog;
  };
  
  function select_default_group_dialog() {
    var open_dialog = select_one_dialog({
      kind : 'group',
      title : '<%= _('Select Default Group') %>',
      tooltip : '<%= _('Click a group name to choose users default group') %>',
      allItems : function (dialogId) {
        return $('#all_grps_string')[0].value.split(",")
      },
      storeItem : function (dialogId, item) {
        $('#form_'+dialogId+' .groupname')[0].value = item;
      }
    });
    return open_dialog;
  };

  function select_roles_dialog() {
    var open_dialog = select_many_dialog({
      kind : 'roles',
      title : '<%= _('Select Roles') %>',
      selected_title : '<%= _('Selected Roles') %>',
      unselected_title : '<%= _('Available Roles') %>',
      tooltip : '<%= _('Click group names to select/unselect roles') %>',
      loadItems : function (dialogId) { 
        return $('#form_'+dialogId+' .roles-string')[0].value.split(",")
      },
      storeItems : function (dialogId, items) { 
        $('#form_'+dialogId+' .roles-string')[0].value = items.join(",");
      },
      allItems : function (dialogId) { 
        return $('#all_roles_string')[0].value.split(",") 
      }
    });
    return open_dialog;
  };

  $(document).ready(function(){

    select_groups_open = select_groups_dialog();
    select_default_group_open = select_default_group_dialog();
    select_roles_open = select_roles_dialog();

// make the error message translatable - override the default messsage
   $.extend($.validator.messages, {
     equalTo:  "<%= _(" The passwords do not match.") -%>",
     required: "<%= _("This field is required.") -%>"
   });

 for(var i=0;i<$('.edit_user').length;i++){
  var id=$('.edit_user')[i].id;
   $("#"+id).validate()

   $("#"+id).validate({
    rules: {
      user_password: "required",
      user_password2: {
        equalTo: "#user_password"
      }
    }
   });

   $("#"+id+" .user-password").pstrength({
      'displayMinChar'      : true,
      'minCharText'      : "<%= _("Password Strength:") %>", 
      'verdicts'      : [
            "<%= _("Weak") %>",
            "<%= _("Normal") %>",
            "<%= _("Medium") %>",
            "<%= _("Strong") %>",
            "<%= _("Very Strong") %>"
          ]
      });
 }

      $(".accordion").accordion({
         autoHeight : false,
         navigation : true,
         collapsible: true,
         header     : 'div.list-fieldset div.list-fieldset-header',
         animated   : false
      });

      $(".accordion").accordion('activate', false);

  $('input#users_search').quicksearch('div.list-fieldset', {
          selector: 'span.quicksearch_content',
          delay: 100
  });

  

});//document.ready

<% end %>

<% end %>
<div class='plugin-icon'><img alt="yast-users" src='/icons/yast-users.png'/><%=_("Users")%></div>
<div class="plugin-content">

<!--<form action="#" id="quicksearch" class="pad1_2em">
  <label><%= _("Filter:") %></label>
  <input type="text" id="users_search"/>
</form>-->

<div id="search-userbar">
  <div id="home-container">
    <div id="home">		
      <%=link_to image_tag ("home.png", :id=>"home_image"), :controller=>"controlpanel", :action => :index %>
    </div>
  </div>
  <span style="clear:both; overflow:hidden;"></span>
  <div id="search-container">
    <form action="#" id="quicksearch">
      <label style="font-weight:bold; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.9);"><%= _("Filter:") %></label>
<!--       <label><%= _("Filter:") %></label> -->
      <input type="text" id="users_search"/>
    </form>
   </div>
   <span style="clear:both; overflow:hidden;"></span>
   <div id="link-container">
    <div id="action_links" class="action_links">	
      <% if @permissions[:useradd] %>
	<%=link_to image_tag ("/icons/yast-users.png", :class=>"icons") +  _("Add New User"), :action => :new %>
	<label>|</label>
      <% end %>      
      <%=link_to image_tag ("/icons/yast-groups.png", :class=>"icons") +  _("Manage Groups"), :controller => "groups" %>
    </div>
  </div>
</div>

<div style="clear:both; overflow:hidden;"></div>

<div class='pad1_2em'>
<% if @permissions[:useradd] %>
<!-- <%= link_to _("Add New User"), :action => :new -%> -->
<% end %>

 <div id="users" class="accordion">
 <% disabled = ! @permissions[:usermodify] %>
  <% for user in @users %>
   <div class="list-fieldset">

    <div class="list-fieldset-header">
     <span class="quicksearch_content">
      <%= h user.uid -%> (<%= h user.cn || "-none-" -%>)
     </span>
    </div>

    <div class='user-content' style="display:none">
     <% form_for(user, :url => { :action => "update" }, :html => { :method => :put, :id => "form_"+user.uid, :onsubmit => "form_handler('#{user.uid}')", :autocomplete => :off } ) do |f| %>
      <%= f.error_messages %>

<%= render :partial => "user_form", :locals =>{ :f => f, :disabled => disabled, :user => user, :new => false } %>

<script language="javascript">
   addTabsNavigation(".tabs_<%= user.uid %>", "span");
   $(".tabs_<%= user.uid %>").tabs();
</script>

    <% end %>
    </div> 
   </div>
  <% end %>
 </div>


  <div class="nav-buttons">
    <%= form_back_button -%>
    <%= form_str_spacer %>
    <%= link_to _("Manage Groups"), "controller" => "groups" %>
  </div>
</div>
            <div><input type="hidden" id="all_grps_string" value="<%= @all_grps_string %>" /></div>
            <div><input type="hidden" id="all_roles_string" value="<%= @all_roles_string %>" /></div>
</div>

