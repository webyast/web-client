<% content_for :head do %>

<%= javascript_include_tag "digitalspaghetti.password.js" %>
<%= javascript_include_tag "users_edit.js" %>
  <style type="text/css">
    label.error { display: none; color: red; padding-left: 11.5em; padding-bottom: 1.5em;  text-align: left; vertical-align: top; width: 50% }
  </style>
<script language='javascript'>

  $(document).ready(function(){

   $("#userForm").validate()

   $("#userForm").validate({
    rules: {
      user_password: "required",
      user_password2: {
        equalTo: "#user_password"
      }
    }
   });

   $("#user_user_password").pstrength({
      'displayMinChar'      : true,
      'minCharText'      : 'Password Strength:', 
      'verdicts'      : [
            "<%= _("Weak") %>",
            "<%= _("Normal") %>",
            "<%= _("Medium") %>",
            "<%= _("Strong") %>",
            "<%= _("Very Strong") %>"
          ],
      });

   $("#accordion").accordion({
      navigation : true,
      header     : 'fieldset legend'
   });

 })

   function user_validation(){
     var valid = $('#userForm').valid();
     // if UID is invalidate, do Show Details (make it visible)
     if ($("#user_uid_number")[0].className.indexOf("error")!=-1) $('#showdetails')[0].children[0].onclick();
     return valid;
   }

    // start password validation workaround only when "Save" button has been pressed
    password_validation_enabled = false;

</script>

<% end %>
<div class='plugin-icon'><img src='/icons/yast-users.png' alt="users module"/>
  <%=_("Local Users") + header_spacer + _("Add new user")%>
</div>
<div class="plugin-content grid_12">
<% form_for :user, :url => { :action => "create"}, :html => { :id => "userForm", :autocomplete => :off}  do |f| %>
  <%= f.error_messages %>

  <div id="accordion">
    <fieldset class="wrapper with-background">
      <legend> Basic User Data</legend>
      <div>
        <p>
          <label><%=_("Full Name")%></label>
          <%= f.text_field :cn %>
        </p>
        <p>
          <label><%=_("Login Name")%></label>
          <%= f.text_field :uid, :class => "required", :onkeyup => "$('#userForm').validate().element('#user_uid');" %>
        </p>
        <p>
          <label><%=_("Password")%></label>
          <%= f.password_field :user_password, :class => "required", :onkeyup => "$('#userForm').validate().element('#user_user_password');"%>
        </p>
        <p>
          <label><%=_("Confirm Password")%></label>
          <%= f.password_field :user_password2, :equalTo => "#user_user_password",:class => "required", :onkeyup => "$('#userForm').validate().element('#user_user_password2');" %>
        </p>
        <!-- this is a pre-generated placeholder for the validation messages -->
        <p><label for="administrator_confirm_password" generated="true" class="error"></label><p>
      </div>
    </fieldset>
    <fieldset class="wrapper with-background">
      <legend>Group Membership</legend>
      <div>
        <p>
          <label><%=_("Groups")%></label>
          <%= f.text_field :grp_string %>
          <a href="#" class="button" onclick="open_groups_dialog();return false;">Manage Groups</a>
        </p>
        <p><label id="groups-error" class="error"></label><p>
        <p>
          <label><%=_("Default Group (GID)")%></label>
          <%= f.text_field :groupname %>
        </p>
        <div id="groups" style="display:none;" title="Groups"> 
          <div>
            <div class="GContainer" id="ContainerUser" onclick="moveItem(event,'ContainerGroups');"> </div>
            <div class="GContainer" id="ContainerGroups" onclick="moveItem(event,'ContainerUser');"> </div>
          <div><%= f.hidden_field :all_grps_string %></div>
          </div>
        </div>
      </div>
    </fieldset>
    <fieldset class="wrapper with-background">
      <legend>Detailed User Data </legend>
      <div>
        <p>
          <label><%=_("UID Number")%></label>
          <%= f.text_field :uid_number, :min => 1000, :class => "number", :onkeyup => "$('#userForm').validate().element('#user_uid_number');"  %>
        </p>
        <p>
          <label><%=_("Home Directory")%></label>
          <%= f.text_field :home_directory %>
        </p>
        <p>
            <%=_("Do not create home directory")%>
            <input type="checkbox" name="nohome" value="true" >
        </p>
        <p>
          <label><%=_("Login Shell")%></label>
          <%= f.text_field :login_shell %>
        </p>
      </div>
    </fieldset>
  </div>
  <fieldset>
    <%= link_to _('Cancel'), {:action => :index}%>
    <%= form_str_spacer %>
    <%= f.submit _("Save"), :onclick=>"return user_validation();" %>
  </fieldset>
<% end %>
</div>
