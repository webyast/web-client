<!--
# Copyright (c) 2009-2010 Novell, Inc.
# 
# All Rights Reserved.
# 
# This program is free software; you can redistribute it and/or modify it
# under the terms of version 2 of the GNU General Public License
# as published by the Free Software Foundation.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, contact Novell, Inc.
# 
# To contact Novell about this file by physical or electronic mail,
# you may find current contact information at www.novell.com
-->
<% content_for :head do %>
<%= javascript_include_tag "users.js" %>
<%= javascript_include_tag "select_dialog.js" %>

<%= javascript_include_tag "jquery.quicksearch.js"-%>

 <style>
    .pad1_2em {
	padding: 1em 2em;
    }
    tr {
	border: solid 1px #ddd;
    }
    label, .qs_input {
	width: auto !important;
    }
    .label { 
	min-width: 10em;
	float: left;
	margin-left: 1em
    }
 </style>

 <% javascript_tag do %>
 jQuery.expr[':'].Contains = function(a, i, m) {
  return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase()) >= 0;
 };

  function select_users_dialog() {
    var open_dialog = select_many_dialog({
      kind : 'users',
      title : '<%= _('Select Members') %>',
      selected_title : '<%= _('Selected Members') %>',
      unselected_title : '<%= _('Available Members') %>',
      tooltip : '<%= _('Click user names to select/unselect members') %>',
      loadItems : function (dialogId) { 
        return $('#groupForm_'+dialogId+' #group_members_string')[0].value.split(",")
      },
      storeItems : function (dialogId, items) { 
        $('#groupForm_'+dialogId+' #group_members_string')[0].value = items.join(",");
      },
      allItems : function (dialogId) { 
        return $('#all_users_string')[0].value.split(",") 
      }
    });
    return open_dialog;
  };

  $(document).ready(function(){
  
    select_users_open = select_users_dialog();

  $('input#groups_search').quicksearch('div.list-fieldset', {
          selector: 'span.quicksearch_content',
          delay: 100
  });

      $(".accordion").accordion({
         autoHeight : false,
         navigation : true,
         collapsible: true,
         header     : 'div.list-fieldset div.list-fieldset-header',
         animated   : false
      });

      $(".accordion").accordion('activate', false);


});//document.ready

function disable(which){
 if (which.childNodes.length == 2 && which.childNodes[0].firstChild.nodeValue == "Delete"){
  which.onclick="";
  which.childNodes[0].onclick="return false;";
  which.childNodes[0].href="";
  // use the same method like repositories
  $(':submit').attr('disabled', 'disabled');
  $(':input').attr('readonly', 'readonly');
  // FIXME: "buttton" has no action but looks like enabled
  $('a.button').attr('onclick','return false;');
  $('a.button').attr('href','');

 }
}
<% end %>

<% end %>
<div class='plugin-icon'><img alt="yast-groups" src='/icons/yast-groups.png'/><%=_("Groups")%></div>
<div class="plugin-content grid_12">

<form action="#" id="quicksearch" class="pad1_2em">
  <label><%= _("Filter:") %></label>
  <input type="text" id="groups_search"/>
</form>

<div class='pad1_2em'>
   <% if @permissions[:groupadd] %>
     <%= link_to _("Add New Group"), :action => :new -%>
   <% end %>
 <div id="groups" class="accordion">

  <% for group in @groups %>
   <div class="list-fieldset">
    <div class="list-fieldset-header">
     <span class="quicksearch_content">
       <%= h group.cn || "-none-" %>
     </span>
    </div>
    <div class='group-content' style="display:none">
<% form_for group, :url => { :action => @adding ? "create" : "update"}, :html => { :id => "groupForm_"+group.old_cn, :autocomplete => :off}  do |f| %>
  <%= f.error_messages %>
  <%= f.hidden_field :old_cn %>
    <p>
      <div class="label"><%=_("Group Name")%></div>
      <%= f.text_field :cn, :disabled => false %>
    </p>
    <p>
      <div class="label"><%=_("Group ID")%></div>
      <%= f.text_field :gid, :disabled => false %>
    </p>
    <p>
      <div class="label"><%=_("Default members")%></div>
      <%= f.text_field :default_members_string, :disabled => true %>
    </p>
    <p>
      <div class="label"><%=_("Members")%></div>
      <%= f.text_field :members_string, :disabled => false, :onkeyup => "members_validation(this);" %>
      <a href="#" class="button" onClick="select_users_open('<%= group.old_cn%>');return false;"><%= _("Manage Members") %></a>
    </p>
    <p><%= f.hidden_field :group_type %><label id="users-error" class="error"></label></p>
    <%= form_next_button :label => _("Save") %>
     <% if @permissions[:groupdelete] %>
     <span onclick="disable(this);"><%= link_to _("Delete"),
                            {:action => 'destroy', :id => group.cn},
                            {:confirm => _("Are you sure to delete group '%s'?") % group.cn, :method => :destroy, :class => :button} %></span>
     <% end %>
<% end %>
    </div>
   </div>
  <% end %>

 </div>
</div>
    <div><input type="hidden" id="all_users_string" value="<%= @all_users_string %>" /></div>

<fieldset>
  <%= form_back_button -%>
</fieldset>
<%= link_to "Manage Users", "controller" => "users" %>
</div>

