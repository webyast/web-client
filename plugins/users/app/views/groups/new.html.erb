<!--
# Copyright (c) 2009-2010 Novell, Inc.
# 
# All Rights Reserved.
# 
# This program is free software; you can redistribute it and/or modify it
# under the terms of version 2 of the GNU General Public License
# as published by the Free Software Foundation.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, contact Novell, Inc.
# 
# To contact Novell about this file by physical or electronic mail,
# you may find current contact information at www.novell.com
-->
<%= javascript_include_tag "group_members.js" %>
<%= javascript_include_tag "select_dialog.js" %>

  <style type="text/css">
    label.error {
         display: none; color: red; padding-left: 11.5em; padding-bottom: 1.5em; margin-top: -0.5em; text-align: left; vertical-align: top; width: 50%
    }

    .GContainerUser, .GContainerGroups {
        float: left;
        margin: 3px;
        border: #669999 2px solid;
        padding: 5px;
     }
     .GBox {
        border: #000 1px solid;
        cursor: pointer;
	display: block;
	float: left;
        font-family: verdana, tahoma, arial;
        font-size: 10px;
        margin-bottom: 5px;
        padding: 2px;
        width: 94px;
     }
     #ContainerUser .GBox {
        background-color: #eee;
     }
  </style>

<script language="javascript">

  function select_users_dialog() {
    var open_dialog = select_many_dialog({
      kind : 'users',
      title : '<%= _('Select Members') %>',
      selected_title : '<%= _('Selected Members') %>',
      unselected_title : '<%= _('Available Members') %>',
      tooltip : '<%= _('Click user names to select/unselect members') %>',
      loadItems : function (dialogId) { 
        return $('#form_'+dialogId+' #group_members_string')[0].value.split(",");
      },
      storeItems : function (dialogId, items) { 
        $('#form_'+dialogId+' #group_members_string')[0].value = items.join(",");
      },
      allItems : function (dialogId) { 
        return $('#all_users_string')[0].value.split(",");
      }
    });
    return open_dialog;
  }

  $(document).ready(function(){
    select_users_open = select_users_dialog();
  });  
</script>
<%
 disabled = ! ((@permissions[:groupadd] && @adding) || (@permissions[:groupmodify] && !@adding)) %>
<div class='plugin-icon'><img src='/icons/yast-groups.png' alt="groups module"/>
  <%=_("Groups") + header_spacer %>
  <%= _("Add new group") %>
</div>

<div class="plugin-content grid_12">

<%= render :partial => 'shared/missing_write_permissions' if disabled %>

<% form_for :group, :url => { :action => "create" }, :html => { :id => "form_new", :autocomplete => :off}  do |f| %>
  <%= f.error_messages %>
  <%= f.hidden_field :old_cn %>

  <fieldset>
    <p>
      <label><%=_("Group Name")%></label>
      <%= f.text_field :cn, :disabled => false %>
    </p>
    <p>
      <label><%=_("Group ID")%></label>
      <%= f.text_field :gid, :disabled => false %>
    </p>
    <p>
      <label><%=_("Default members")%></label>
      <%= f.text_field :default_members_string, :disabled => true %>
    </p>
    <p>
      <label><%=_("Members")%></label>
      <%= f.text_field :members_string, :disabled => false, :onkeyup => "members_validation(this);" %>
      <a href="#" class="button" onClick="select_users_open('new');return false;">Manage Memebers</a>
    </p>
    <p><%= f.hidden_field :group_type %><label id="users-error" class="error"></label><p>
  </fieldset>

  <div id="members" style="display:none;" title="Members">
     <div>
      <div class="GContainerUser" style="width: 100px;" id="ContainerUser" onclick="moveItem(event,'ContainerGroups');"> </div>
      <div class="GContainerGroups" style="width: 400px;" id="ContainerGroups" onclick="moveItem(event,'ContainerUser');"> </div>
     </div>
  </div>

  <fieldset>
    <%= form_cancel_button :action => :index %>
    <%= form_str_spacer %>
    <%= form_next_button %>
  </fieldset>

<% end %>
    <div><input type="hidden" id="all_users_string" value="<%= @all_users_string %>" /></div>
</div>
