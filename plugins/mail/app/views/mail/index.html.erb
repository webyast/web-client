<!--
# Copyright (c) 2009-2010 Novell, Inc.
# 
# All Rights Reserved.
# 
# This program is free software; you can redistribute it and/or modify it
# under the terms of version 2 of the GNU General Public License
# as published by the Free Software Foundation.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, contact Novell, Inc.
# 
# To contact Novell about this file by physical or electronic mail,
# you may find current contact information at www.novell.com
-->

<% content_for :head do %>
  <%= javascript_include_tag :defaults %>

  <style type="text/css">
    label.error { display: none; color: red; padding-left: 11.5em; padding-bottom: 1.5em; margin-top: -0.5em; text-align: left; vertical-align: top; width: 50% }
  </style>

<%= javascript_include_tag "validation.js" %>
<script type="text/javascript">
  
    $(document).ready(function() {
      validateDomainNameWithPortNumber("smtp_server");
      $("#mailForm").validate()
       // make the error message translatable - override the default messsage
       $.extend($.validator.messages, {
		  equalTo: "<%= _("The passwords do not match.") -%>",
		  email:	 "<%= _("Enter a valid e-mail address.") -%>",
		  smtp_server: "<%= _("Enter a valid domain name or an IP address.")  -%>" 
       });
    });

    $(document).ready(function() {
      if ($("#mail_test_mail_address", "#mailForm").val() == "") {
        $("#mail_submit").attr("disabled","disabled");
      }
      $("#mail_test_mail_address").keyup(function () {
	if ($("#mail_test_mail_address", "#mailForm").val() == "") $("#mail_submit").attr("disabled","disabled");
	else $("#mail_submit", "#mailForm").removeAttr("disabled");
      }); 
    });
</script>

<% end %>

<div class='plugin-icon'><img src='/icons/yast-mail-server.png'/><%=_("Mail Settings")%></div>

<div class='plugin-content grid_12'>

<% disabled = ! @permissions[:write] %>

<%= render :partial => 'shared/missing_write_permissions' if disabled %>

  <% form_for(:mail, @mail, :url => { :action => "update" }, :html => { :method => :put, :id => "mailForm", :autocomplete => :off, :onsubmit => "if ($('#mailForm').valid()) $('#progress').show()" } ) do |f| %>
  <%= f.error_messages %>
    <fieldset  class="wrapper with-background">
      <p>
        <label for="<%= :smtp_server %>"><%=_("Outgoing mail server")%></label>
        <%=f.text_field :smtp_server, :disabled => disabled, :class => "smtp_server" %></p>
      <p>
        <label><%=_("Use secure connection (TLS)")%></label>
        <%= f.select :transport_layer_security, [ [_("Never"), "no" ], [_("If available"), "yes"], [_("Always"), "must"]], :disabled => disabled %></p>
      <p>
        <label><%=_("User name")%></label>
        <%= f.text_field :user, :disabled => disabled %></p>
      <p>
        <label><%=_("Password")%></label>
        <%= f.password_field :password, :disabled => disabled %></p>
      <p>
        <label><%=_("Confirm password")%></label>
        <%= f.password_field :confirm_password, :disabled => disabled, :equalTo => "#mail_password", :onkeyup => "$('#mailForm').validate().element('#mail_confirm_password');" %>
      </p>
      <!-- this is a pre-generated placeholder for the validation messages -->
      <p><label for="mail_confirm_password" generated="true" class="error"></label></p>
    </fieldset> 
    <fieldset  class="wrapper with-background">
      <p>
        <label><%=_("Send test mail to")%></label>
        <%= f.text_field :test_mail_address, :disabled => disabled, :class => "email" %>
	<%= f.submit _("Send Mail"), :name => "send_mail" %>
      </p>
      <p><label for="mail_test_mail_address" generated="true" class="error"></label></p>
    </fieldset> 
    <p>
    <%= form_send_buttons :disabled => disabled %>
    </p>
  <% end %>
</div>

