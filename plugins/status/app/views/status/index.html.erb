
<% content_for :head do %>

<!--[if IE]><script type="text/javascript" charset="utf-8" src="/javascripts/excanvas.js"></script><![endif]-->
<script type="text/javascript" charset="utf-8" src="/javascripts/jquery.jqplot.js"></script>
<script type="text/javascript" charset="utf-8" src="/javascripts/plugin/jqplot.pieRenderer.js"></script>
<script type="text/javascript" charset="utf-8" src="javascripts/plugin/jqplot.categoryAxisRenderer.js"></script>
<script type="text/javascript" charset="utf-8" src="javascripts/plugin/jqplot.dateAxisRenderer.js"></script>
<script type="text/javascript" charset="utf-8" src="javascripts/plugin/jqplot.canvasTextRenderer.js"></script>

<script type="text/javascript">

function refreshLogs() {

<% @logs.each do |log| %>
  $('#log-<%= log.id %>-console').load('/status/ajax_log_custom?id=<%= log.id %>&lines=5');
<% end %>
}

$(document).ready(function() {
  $.ajaxSetup ({  
    cache: false  
  });
  //$('#log-console').addClass('busy');
  setInterval(refreshLogs, 10000); // refresh every 10 seconds
});

function initMenuBar() {
  $('#menu ul').hide();
  $('#menu li a').click(
    function() {
        $(this).next().slideToggle('slow');
      }
    );
  }
$(document).ready(function() {initMenuBar();});

</script>
<% end %>

<%= javascript_include_tag :defaults %>

<div class='plugin-icon'><img src='/images/monitoring.png'/><%=_("Status")%></div>
<div class="plugin-content grid_12">
  <% @logs.each do |log| %>
  <h2><%= log.description %></h2>
  <div id="<%="log-#{log.id}-console"%>" >
    <%= log.path %>
  </div>
<% end %>


<div id="log-console">
</div>
<% if @graphs %>
  <ul id="menu">
  <% @graphs.each do |group| %>
    <li>
      <% if limits_reached(group) %>
        <% status_icon = "<div class='status-icon error'></div>" %>
      <% else %>
         <% status_icon = "<div class='status-icon ok'></div>" %>
      <% end %>
      <%=link_to_remote status_icon + group.id, :update => graph_id(group.id, group.single_graphs.first.headline),
        :url => { :action => "evaluate_values", :group_id => group.id, :graph_id => group.single_graphs.first.headline },
        :complete => evaluate_next_graph(group.id, group.single_graphs, 1 )%>
      <ul>

          <% group.single_graphs.each do |single_graph| %>
            <p>     
              <h3><%= single_graph.headline %></h3>    
            </p>
            <p>
              <% measurement_id = "measurement_" + group.id + "_" + single_graph.headline%>
              <%= _("Show last") %> <select name="<%=measurement_id%>" id="<%=measurement_id%>">
		<option value="5"><%= _("5 Minutes") %></option>
		<option value="15"><%= _("15 Minutes") %></option>
		<option value="30"><%= _("30 Minutes") %></option>
		<option value="60"><%= _("1 Hour") %></option>
		<option value="360"><%= _("6 Hours") %></option>
		<option value="720"><%= _("12 Hours") %></option>
              </select>
              <%= observe_field(measurement_id,
                :update => graph_id(group.id, single_graph.headline),
                :frequency => 0.25,
                :loading => "$('#progress').show()",
                :url => { :action => "evaluate_values", :group_id => group.id, :graph_id => single_graph.headline },
                :complete => "$('#progress').hide()",
                :with => "'minutes=' + value" ) %>
            </p>
            <p>         
              <%= graph(graph_id(group.id, single_graph.headline), 400, 300) %>
            </p>
          <% end %>
      </ul>
    </li>
  <% end %>
  </ul>
<% end %>
<p>
<%= link_to  _("Edit Limits"), '/status/edit', :class => "button" %>
</p>
<p>
<a href="/" class="button"><%=_("Back")%></a>
</p>
</div>

