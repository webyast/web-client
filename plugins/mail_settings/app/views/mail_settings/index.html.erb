<div class='plugin-icon'><img src='/icons/yast-mail-server.png'/></div>

<% content_for :head do %>
  <%= javascript_include_tag :defaults %>

  <style type="text/css">
    label.error { float: none; color: red; padding-left: .5em; vertical-align: top; }
  </style>

<script type="text/javascript">
    // define custom validation function for SMTP server validation
    jQuery.validator.addMethod("smtp_server", function(value, element) {
      return this.optional(element)
        // FQDN: http://regexlib.com/REDetails.aspx?regexp_id=391
        || /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/.test(value)
        // IPv4: http://regexlib.com/REDetails.aspx?regexp_id=32
        || /^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$/.test(value)
        // IPv6: http://regexlib.com/REDetails.aspx?regexp_id=906 + allow lowercase hexa letters (a-f)
        || /^(^(([0-9A-Fa-f]{1,4}(((:[0-9A-Fa-f]{1,4}){5}::[0-9A-Fa-f]{1,4})|((:[0-9A-Fa-f]{1,4}){4}::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,1})|((:[0-9A-Fa-f]{1,4}){3}::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,2})|((:[0-9A-Fa-f]{1,4}){2}::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,3})|(:[0-9A-Fa-f]{1,4}::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,4})|(::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,5})|(:[0-9A-Fa-f]{1,4}){7}))$|^(::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,6})$)|^::$)|^((([0-9A-Fa-f]{1,4}(((:[0-9A-Fa-f]{1,4}){3}::([0-9A-Fa-f]{1,4}){1})|((:[0-9A-Fa-f]{1,4}){2}::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,1})|((:[0-9A-Fa-f]{1,4}){1}::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,2})|(::[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,3})|((:[0-9A-Fa-f]{1,4}){0,5})))|([:]{2}[0-9A-Fa-f]{1,4}(:[0-9A-Fa-f]{1,4}){0,4})):|::)((25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{0,2})\.){3}(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{0,2})$$/.test(value);

    }, "<%= _("Enter a valid domain name or an IP address.") -%>");

 </script>

  <script type="text/javascript">
     $(document).ready(function(){
	$("#mailForm").validate()
     });
  </script>
<% end %>


<h2><%=_("Mail Settings")%></h2>

<% disabled = ! @permissions[:write] %>

<div class="table">
  <% form_for(:mail_settings, @mail_settings, :url => { :action => "update" }, :html => { :method => :put, :id => "mailForm" } ) do |f| %>
  <table class="list">
  <%= f.error_messages %>
    <tr class="bg">
	<td class="first"><%=_("Outgoing mail server (SMTP)")%></strong></td>
	<td class="last"><%= f.text_field :smtp_server, :disabled => disabled, :class => "smtp_server" %></td>
    </tr>
    <tr class="bg">
	<td class="first"><%=_("Transport Layer Security (TLS)")%></td>
	<td class="last"><%= f.select :transport_layer_security, [ [_("Disabled"), "NONE" ], [_("If available"), "MAY"], [_("Always"), "MUST"]], :disabled => disabled %></td>
    </tr>
    <tr class="bg">
	<td class="first"><%=_("User name")%></td>
	<td class="last"><%= f.text_field :user, :disabled => disabled %></td>
    </tr>
    <tr class="bg">
	<td class="first"><%=_("Password")%></td>
	<td class="last"><%= f.password_field :password, :disabled => disabled %></td>
    </tr>
    <tr class="bg">
	<td class="first"><%=_("Confirm Password")%></td>
        <td class="last"><%= f.password_field :confirm_password, :disabled => disabled, :equalTo => "#mail_settings_password" %></td>
    </tr>
    <tr>
    <td><%= form_send_buttons :onclick=>"Element.show('progress')" %></td>
    </tr>
  </table>
  <% end %>
</div>
